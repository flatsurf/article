\documentclass{article}

\usepackage{amsmath,amssymb}
\usepackage{graphicx,subcaption}
\usepackage{url}
\usepackage[margin=2cm]{geometry}
\usepackage[abbreviations]{foreign}
\usepackage{xcolor}

\def\CC{\mathbb{C}}

\def\cA{\mathcal{A}}
\def\cE{\mathcal{E}}

\def\Re{\operatorname{Re}}
\def\Im{\operatorname{Im}}
\def\Sym{\operatorname{Sym}}

\newtheorem{definition}{Definition}
\newtheorem{remark}[definition]{Remark}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{theorem}[definition]{Theorem}

\title{Algorithms for translation surfaces}
\author{Vincent Delecroix for Julian R\"uth}

\newcommand{\commv}[1]{{\color{red!50!gray}[#1]}}	

\begin{document}
\maketitle

\section{Topology and combinatorial maps}
\label{sec:TriangulationsAndTranslationStructures}

A cell decomposition of a surface can be encoded by a triple of
permutations.
\begin{definition}
Let $\cE$ be a finite set.
A \emph{combinatorial map} or a \emph{fat graph} on $\cE$ is a triple
of permutations $(\sigma_v, \sigma_e, \sigma_f) \in \Sym(\cE)^3$ on
the set $\cE$ such that
\begin{enumerate}
\item $\sigma_f \circ \sigma_e \circ \sigma_v = id_\cE$,
\item $\sigma_e$ is an involution without fixed points,
\item the group generated by $\sigma_v, \sigma_e, \sigma_f$ acts transitively on $\cE$.
\end{enumerate}
\end{definition}
In the definition the letters  $v$, $e$ and $f$ respectively stand for vertices, edges
and faces.  Each cycle of the cycle decomposition of $\sigma_v$, $\sigma_e$
and $\sigma_e$ represents respectively a vertex, an edge
and a face of the cell decomposition. In particular, the cardinality of $\cE$
is even. The transitivity of the group ensures the connectivity of the surface.
The set $\cE$ can be identified with half edges or oriented edges.

We will always denote $n_v$, $n_e$ and $n_f$ respectively the number of vertice,
edges and faces of the combinatorial map $(\sigma_v, \sigma_e, \sigma_f)$. In
combinatorial terms it corresponds to the number of cycles in the cycle decomposition
of $\sigma_v$, $\sigma_e$ and $\sigma_f$.

A particular case of combinatorial maps are \emph{triangulations}
when the permutation $\sigma_f$ is a product of disjoint 3-cycles.
In these situation $n$ is a multiple of $6$.

\begin{figure}[!ht]
\begin{minipage}{0.4\textwidth}
\begin{center}
\includegraphics{pictures/Torus.pdf}
\subcaption{A square torus $\sigma_v = (0,1,2,3)$, $\sigma_e=(0,2)(1,3)$, $\sigma_f=(0,1,2,3)$.}
\end{center}
\end{minipage}
\hspace{0.1\textwidth}
\begin{minipage}{0.4\textwidth}
\begin{center}
\includegraphics{pictures/TriangulatedTorus.pdf}
\subcaption{A triangulated torus $\sigma_v = (0,4,1,2,5,3)$, $\sigma_e=(0,2)(1,3)(4,5)$, $\sigma_f=(0,1,5)(2,3,4)$.}
\end{center}
\end{minipage}
\caption{Examples of combinatorial maps on a torus.}
\label{fig:CombinatorialMapTori}
\end{figure}


The \emph{dual} of the combinatorial map $(\sigma_v, \sigma_e, \sigma_f)$ is the combinatorial
map $(\sigma_f^{-1}, \sigma_e, \sigma_v^{-1})$.
\begin{figure}[!ht]
\begin{center}
\includegraphics{pictures/DualCombinatorialMaps.pdf}
\end{center}
\caption{Dual combinatorial maps}
\label{fig:DualCombinatorialMaps}
\end{figure}

Figure~\ref{fig:DualCombinatorialMaps} provides a local picture of two dual
combinatorial maps.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elementary moves: removing, adding, flipping edges}
\label{sec:ElementaryMoves}
Let $(\sigma_v, \sigma_e, \sigma_f)$ be a combinatorial map on $\cE$. We define three operations
(and their inverses) that allow to move through the space of all combinatorial maps of given genus.

\subsection{Removing edges / splitting faces}
\textbf{removing an edge}:
Let $(x,y)$ be a transposition of $\sigma_e$ such that the two faces adjacent to this
edge are different then we can remove this edge and obtain a new combinatorial map.
\begin{center}\includegraphics{pictures/RemoveEdge.pdf}\end{center}
The operation on the permutations is given as follows
\begin{align*}
\sigma_v = (j,x,A) (i,y,B) \ldots & \mapsto (j,A) (i,B) \ldots \\
\sigma_e = (j, \sigma_e(j)) (i, \sigma_e(i)) (x,y) \ldots & \mapsto (j, \sigma_e(j)) (i, \sigma_e(i)) \ldots \\
\sigma_f = (x,i,C) (y,j,D) \ldots & \mapsto (i,C,j,D) \ldots 
\end{align*} 
This operation merges the two faces adjacent to the edge $(x,y)$ into a single bigger face.
The new combinatorial map is on the set $\cE \setminus \{x,y\}$.

\textbf{splitting a face}:
This is simply the reverse procedure of removing an edge.

\subsection{Contracting edges / splitting vertices}
\textbf{contracting an edge}:
dual to "removing an edge"

\textbf{splitting a vertex}:
reverse to the above.

\subsection{Forward flip / backward flip}
The operation considered above modifies the number of edges of the combinatorial map.

\textbf{forward edge flip in a face}
\begin{center}\includegraphics{pictures/FlipEdge.pdf}\end{center}
Given an edge $(x,y)$ that is adjacent to distinct faces, we can perform an
"edge flip" as in the above figure.
The flip operation does not change the underlying set $\cE$.

\textbf{forward edge flip at a vertex}

\bigskip

\section{Translation structures}
\begin{definition}
\label{def:FlatTriangulation}
Let $T = (\sigma_v, \sigma_e, \sigma_f) \in \Sym(\cE)^3$ be a 
triangulation, a \emph{translation structure} on $T$
is a family of non-zero complex numbers $\{\zeta_i\}_{i\in\cE}$
such that
\begin{enumerate}
\item for each cycle $(i,j)$ of $\sigma_e$ we have $\zeta_i + \zeta_j = 0$
\item for each cycle $(i_1,i_2,i_3)$ of $\sigma_f$ 
the vectors $\zeta_{i_1}$, $\zeta_{i_2}$, $\zeta_{i_3}$ form the
sides of a triangle in $\CC$ where the sides appear in counter-clockwise order
(in particular $\zeta_{i_1} + \zeta_{i_2} + \zeta_{i_3} = 0$).
\end{enumerate}
\end{definition}
A translation surface is a geometrical notion and using triangulations
and the above definition is very often not enough.
For example in~\cite{veerer}, we need a more restrictive version
(related to the slopes of the vectors $\zeta_i$).
On the other hand, one might want to generalize translation structures
to cell decompositions that are not triangulations. An example of
this is considered in the next section with the zippered rectangle
construction.

For now, let us consider a simple definition that is not the most
general possible but which is simple to state.
\begin{definition}
\label{def:EmbeddedTranslationStructure}
Let $M = (\sigma_v, \sigma_e, \sigma_f) \in \Sym(\cE)$ be a combinatorial
map. An \emph{embedded translation structure} for $M$ is a zet of non-zero
complex numbers $\{\zeta_i\}_{i=1,\ldots,2n}$ such that
\begin{enumerate}
\item for each cycle $(i,j)$ of $\sigma_e$ we have
$\zeta_i + \zeta_j = 0$
\item for each cycle $(i_1,i_2,\ldots,i_k)$ of $\sigma_f$ the vectors
$\zeta_{i_1}$, \ldots, $\zeta_{i_k}$ form the sides of a $k$-gon in
$\CC$ where the vectors appear in counter-clockwise order.
\end{enumerate}
\end{definition}

\begin{remark}
When the $\zeta_i$ do not form a polygon it is still
possible to define a unique translation structure if and
only if the index around each face is $+1$ (where this index is measured in terms
of the arguments of the complex numbers $\zeta_i$). For now, let me avoid making
a formal definition but just say that for triangulations
this is equivalent to Definition~\ref{def:FlatTriangulation}.
\end{remark}

A \emph{sub-translation structure} is one that can be obtained by forgetting
some edges (see also Section~\ref{sec:ElementaryMoves}. Because a polygon can always be triangulated we have the following.
\begin{lemma}
Given a combinatorial map and a translation structure on it $(M,\zeta)$, there
exists a triangulation with a translation structure $(T,\zeta')$ so that $M$ is
a sub-translation structure of $T$.

Conversely, given a triangulation with a translation structure, this translation
structure restricted to any sub cell decomposition is a (not necessarily embedded)
translation structure.
\end{lemma}


\subsection{Elementary moves on translation structures}
\subsection{edge flips}
structure the newly added edge must be a valid straight-line segment.
In the special cases the two adjacent faces are triangles, the condition
for flipping the edge (which is one diagonal of the quadrilateral) is that the
quadrilateral is convex.
\begin{center}\includegraphics{pictures/QuadrilateralFlip.pdf}\end{center}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{From translation structures to interval exchange transformation}
A zippered rectangle is a form of cell decomposition of a translation
surface into rectangles. It can be viewed as a particular kind of translation
structure as discussed in the previous Section. Though, as we will see, this
is not necessarily embedded.

\subsection{What is a zippered rectangle?}
\begin{definition}
\label{def:WeakZipperedRectangle}
Let $\cE$ be a finite set of cardinality $2d$.
A \emph{topological zippered rectangle} is a combinatorial map $(\sigma_v, \sigma_e, \sigma_f) \in \Sym(\cE)^3$ such that
\begin{enumerate}
\item $\sigma_f$ is a $2d$-cycle (that is the cell decomposition consists of a single cell),
\item there is a partition of $\cE^{top} \cup \cE^{bot} = \cE$ such that the 
involutions $(\sigma_f)^d$ and $\sigma_e$ exchanges $\cE^{top}$ and $\cE^{bot}$.
\end{enumerate}
A \emph{weak zippered rectangle translation structure} for $(\sigma_v, \sigma_e, \sigma_f)$ is
a set of complex non-zero vectors $\zeta_i$ such that
\[
\forall i \in \cE^{bot}, \Re(\zeta_i) \geq 0
\qquad
\forall i \in \cE^{top}, \Re(\zeta_i) \leq 0.
\]
\end{definition}
Note that the above definition only involves the real parts of the vectors $\zeta_i$.
What is missing to make it a zippered rectangle is a condition on imaginary parts
that correspond the equation $(S_\pi)$ in~\cite{Yoccoz} on the suspension vector. For
our purpose, this condition is useless and let us ignore it for the moment.
\begin{figure}[!ht]
\begin{center}\includegraphics{pictures/MasurPolygon.pdf}\end{center}
\caption{A zippered rectangle translation structure with combinatorial data
$\sigma_v = (0,7,14,1,16,11,4,17)$ or
$\sigma_e = (0,16)(1,17)(7,11)(4,14)$ and
$\sigma_f = (0,1,4,7,16,17,14,11)$. Here $\cE^{top} = \{0,11,14,17\}$ and $\cE^{bot} = \{4,7,16,17\}$. It is depicted as a sub-translation structure of an embedded triangulation.}
\label{fig:TriangulationYoccoz}
\end{figure}

The triangulations in Figure~\ref{fig:TriangulationYoccoz} is
\begin{align*}
\sigma_v &= (0,3,6,9,7,5,14,15,1,16,13,10,8,11,12,4,2,17) \\
\sigma_e &= (0,16)(1,17)(2,3)(4,14)(5,6)(7,11)(8,9)(10,12)(13,15) \\
\sigma_f &= (0,1,2)(3,4,5)(6,7,8)(9,10,11)(12,13,14)(15,16,17)
\end{align*}
Here is a code sample to it with \cite{surface-dynamics}
\begin{verbatim}
sage: from surface_dynamics import FatGraph
sage: edges = '(0,16)(1,17)(2,3)(4,14)(5,6)(7,11)(8,9)(10,12)(13,15)'
sage: faces = '(0,1,2)(3,4,5)(6,7,8)(9,10,11)(12,13,14)(15,16,17)'
sage: FatGraph(ep=edges, fp=faces)
FatGraph('(0,3,6,9,7,5,14,15,1,16,13,10,8,11,12,4,2,17)',
'(0,16)(1,17)(2,3)(4,14)(5,6)(7,11)(8,9)(10,12)(13,15)', 
'(0,1,2)(3,4,5)(6,7,8)(9,10,11)(12,13,14)(15,16,17)')
\end{verbatim}

Now, given a topological zippered rectangle $(\sigma_v, \sigma_e, \sigma_f)$ we describe
how to construct the bijections $\pi_t:\cA \to \{1,\ldots,d\}$ and $\pi_b: \cA \to \{1,\ldots,d\}$ of~\cite{Yoccoz}.
Let $\cA$ be the set of the $d$ transpositions that appear in the cycle decomposition
of $\sigma_e$ (these are the edges of the combinatorial map). Then by the second
condition, $\cE^{top}$ and $\cE^{bot}$ are in canonical bijections with $\cA$: to an
half-edge $i$ associates the unique transposition in $\cA$ that contains $i$.
Next, there is a unique way to write $\sigma_f$ as
\[
\sigma_f = (b_1, b_2, \ldots, b_d, t_d, t_{d-1}, \ldots, t_1)
\]
where $\cE^{bot} = \{b_1, \ldots, b_d\}$ and $\cE^{top} = \{t_1, \ldots, t_d\}$.
Then, for $\alpha = (t_i, b_j) \in \cA$ we set $\pi_t(\alpha) = i$ and $\pi_b(\alpha) = j$.

In the example of Figure~\ref{fig:TriangulationYoccoz}, we have
\[
t_1 = 0,\ t_2 = 11,\ t_3 = 14,\ t_4 = 17
\qquad
b_1 = 1,\ b_2 = 4,\ b_3 = 7,\ b_4 = 16
\]

\subsection{Naive version}
\textit{(discussed on April 22)}

Pick an edge and build the first return map to this edge.
For that purpose, follow the (vertical) translation flow until it comes back to this edge.


\subsection{The algorithm}
We now describe an algorithm that given a translation structure on
a triangulation (Definition~\ref{def:FlatTriangulation}) produces a union
of weak zippered rectangle translation structure (Definition~\ref{def:WeakZipperedRectangle})
(for the same underlying translation surface).

We are given a triangulation $T = (\sigma_v, \sigma_e, \sigma_f)$ with a
translation structure $\{\zeta_i\}_{i \in \cE} \subset \CC^\cE$.
We fix an initial triangle $t_0$ and want to aggregate some of its neighbors
in order that it still looks like a zippered rectangle. In order to describe
the intermediate steps of the algorithm we need an extra definition.
\begin{definition}
Let $M,\zeta$ be a translation structure. We say that it is a
\emph{multi-zippered rectangle} if there is a partition $\cE = \cE^{top} \sqcup \cE^{bot}$
such that
\begin{enumerate}
\item for $i \in \cE^{top}$, $\Re(\zeta_i) \geq 0$ and for $i \in \cE^{bot}$, $\Re(\zeta_i) \leq 0$,
\item $\sigma_e$ exchanges $\cE^{top}$ with $\cE^{bot}$
\item each cycle $c$ of $\sigma_f$ (that corresponds to a face of the combinatorial map)
is (uniquely) written as $c = (b_1, b_2, \ldots, b_m, t_n, t_{n-1}, \ldots, t_1)$ with
$t_i \in \cE^{top}$ and $b_j \in \cE^{bot}$.
\end{enumerate}
\end{definition}

The algorithm consists of two different subroutines
\begin{enumerate}
\item \emph{aggregation}: where we just remove edges trying to enlarge the cycles
of $\sigma_f$ while keeping the translation structure in a form of a multi-zippered rectangle,
\item \emph{reduction}: that consists in flipping edges and can be seen
as a generalized Rauzy induction.
\end{enumerate}


%The first step is to build a multi-interval exchange
%transformation out of a triangulation. Each triangle
%will correspond to an interval of the transformation
%and each edge will correspond to a subinterval of the
%transformation.
%
%Each triangle $(a,b,c)$ gives rise of two possible type
%of interval. Either
%\[
%\begin{array}{l}
%b\ a \\
%c
%\end{array}
%\qquad \text{or} \qquad
%\begin{array}{l}
%a \\
%b\ c
%\end{array}
%\]
%We call the first kind bottom-dominant and the second top-dominant.
%
%For each of these intervals, we can forget about the big edge and glue it
%to where it is glued. That diminish the number of intervals under consideration. In
%geometric terms, it corresponds to remove some of the edges of the triangulations.
%
%Another possible bootstrap option: start at a given vertex and look at the horizontal in the right
%direction. We start crossing triangles and we stop at the time we meet a triangle that we already
%encountered. Then remove all edges that are crossed by this horizontal piece. This makes a nice "Masur polygon".
%And we should start again from another vertex until we get rid of all the triangles.
%

\begin{thebibliography}{sage-flatsurf}

\bibitem[sage-flatsurf]{sage-flatsurf}
V. Delecroix, P. Hooper
\url{https://github.com/videlec/sage-flatsurf}

\bibitem[surface\_dynamics]{surface-dynamics}
V. Delecroix
\texttt{surface\_dynamics}

\bibitem[veerer]{veerer}
M. Bell, V. Delecroix, S. Schleimer
\texttt{veerer}

\bibitem[Yoccoz]{Yoccoz}
Jean-Christophe Yoccoz
\textit{Interval exchange maps and translation surfaces}
in Homogeneous flows, moduli spaces and arithmetic.
Proceedings of the Clay Mathematics Institute summer school,
(2010).
\end{thebibliography}

\end{document}
