\documentclass[a4paper,12pt]{article}

\usepackage{amsmath,amssymb,amsthm}
\usepackage{graphicx,subcaption}
\usepackage{url}
\usepackage[margin=2cm]{geometry}
\usepackage[abbreviations]{foreign}
\usepackage{xcolor}

\def\RR{\mathbb{R}}
\def\CC{\mathbb{C}}

\def\bC{\mathbb{C}}
\def\bR{\mathbb{R}}
\def\bQ{\mathbb{Q}}
\def\bZ{\mathbb{Z}}

\def\cA{\mathcal{A}}
\def\cE{\mathcal{E}}
\def\cH{\mathcal{H}}
\def\cM{\mathcal{M}}

\def\Re{\operatorname{Re}}
\def\Im{\operatorname{Im}}
\def\Sym{\operatorname{Sym}}
\def\SL{\operatorname{SL}}
\def\GL{\operatorname{GL}}
\def\Hol{\operatorname{Hol}}
\def\rank{\operatorname{rank}}

\newtheorem{definition}{Definition}
\newtheorem{remark}[definition]{Remark}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{proposition}[definition]{Proposition}

\title{Algorithms for translation surfaces}
\author{Vincent Delecroix for Julian R\"uth}

\newcommand{\commv}[1]{{\color{red!50!gray}{#1}}}	

% https://tex.stackexchange.com/a/4881
\newcommand*{\defeq}{\mathrel{\vcenter{\baselineskip0.5ex \lineskiplimit0pt
                     \hbox{\scriptsize.}\hbox{\scriptsize.}}}%
                     =}

\begin{document}
\maketitle

\tableofcontents

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Topology and combinatorial maps}
\label{sec:TriangulationsAndTranslationStructures}
We describe how cell decomposition of surfaces can be efficiently encoded by
a triple of permutations. A more detailed description can be found in
\cite[Section 1.3.1 "Graphs versus Maps"]{LandoZvonkin}.

A cell decomposition of a surface can be encoded by a triple of
permutations.
\begin{definition}
Let $\cE$ be a finite set.
A \emph{combinatorial map} or a \emph{fat graph} on $\cE$ is a triple
of permutations $(\sigma, \alpha, \phi) \in \Sym(\cE)^3$ on
the set $\cE$ such that
\begin{enumerate}
\item $\phi \circ \alpha \circ \sigma = id_\cE$,
\item $\alpha$ is an involution without fixed points,
\item the group generated by $\sigma, \alpha, \phi$ acts transitively on $\cE$.
\end{enumerate}
\end{definition}
In the definition the greek letters  $\sigma$, $\alpha$ and $\phi$ respectively stand
for sommet (french for vertices), ar\^etes (edges) and faces. This notation is borrowed
from~\cite{LandoZvonkin}. Each cycle of the cycle
decomposition of $\sigma$, $\alpha$ and $\phi$ represents respectively a vertex, an edge
and a face of the cell decomposition. In particular, the cardinality of $\cE$
is even. The transitivity of the group ensures the connectivity of the surface.
The set $\cE$ can be identified with half edges or oriented edges.

\begin{remark}
The notion of 3-constellation introduced in~\cite{LandoZvonkin} is more general as it
avoids item 2: $\alpha$ can be any permutation.
\end{remark}

If $g$ is a permutation we denote $c(g)$ the number of cycles of the permutation $g$.
The numbers $c(\sigma)$, $c(\alpha)$ and $c(\phi)$ are respectively the number of vertices,
edges and faces of the combinatorial map $(\sigma, \alpha, \phi)$.

A particular case of combinatorial maps are \emph{triangulations}
when the permutation $\phi$ is a product of disjoint 3-cycles.
In these situation $\# \cE$ is a multiple of $6$.

\begin{figure}[!ht]
\begin{minipage}{0.4\textwidth}
\begin{center}
\includegraphics{pictures/Torus.pdf}
\subcaption{A square torus $\sigma = (0,1,2,3)$, $\alpha=(0,2)(1,3)$, $\phi=(0,1,2,3)$.}
\end{center}
\end{minipage}
\hspace{0.1\textwidth}
\begin{minipage}{0.4\textwidth}
\begin{center}
\includegraphics{pictures/TriangulatedTorus.pdf}
\subcaption{A triangulated torus $\sigma = (0,4,1,2,5,3)$, $\alpha=(0,2)(1,3)(4,5)$, $\phi=(0,1,5)(2,3,4)$.}
\end{center}
\end{minipage}
\caption{Examples of combinatorial maps on a torus.}
\label{fig:CombinatorialMapTori}
\end{figure}


The \emph{dual} of the combinatorial map $(\sigma, \alpha, \phi)$ is the combinatorial
map $(\phi^{-1}, \alpha, \sigma^{-1})$.
\begin{figure}[!ht]
\begin{center}
\includegraphics{pictures/DualCombinatorialMaps.pdf}
\end{center}
\caption{Dual combinatorial maps}
\label{fig:DualCombinatorialMaps}
\end{figure}

Figure~\ref{fig:DualCombinatorialMaps} provides a local picture of two dual
combinatorial maps.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elementary moves: removing, adding, flipping edges}
\label{sec:ElementaryMoves}
Let $(\sigma, \alpha, \phi)$ be a combinatorial map on $\cE$. We define three operations
(and their inverses) that allow to move through the space of all combinatorial maps of given genus.

\subsection{Removing edges / splitting faces}
\noindent\textbf{removing an edge}:
Let $(x,y)$ be a transposition of $\alpha$ such that the two faces adjacent to this
edge are different then we can remove this edge and obtain a new combinatorial map.
\begin{center}\includegraphics{pictures/RemoveEdge.pdf}\end{center}
The operation on the permutations is given as follows
\begin{align*}
\sigma = (j,x,A) (i,y,B) \ldots & \mapsto (j,A) (i,B) \ldots \\
\alpha = (j, \alpha(j)) (i, \alpha(i)) (x,y) \ldots & \mapsto (j, \alpha(j)) (i, \alpha(i)) \ldots \\
\phi = (x,i,C) (y,j,D) \ldots & \mapsto (i,C,j,D) \ldots
\end{align*}
This operation merges the two faces adjacent to the edge $(x,y)$ into a single bigger face.
The new combinatorial map is on the set $\cE \setminus \{x,y\}$.

\noindent\textbf{splitting a face}:
This is simply the reverse procedure of removing an edge.

\subsection{Contracting edges / splitting vertices}
\noindent\textbf{contracting an edge}:
dual to "removing an edge"

\noindent\textbf{splitting a vertex}:
reverse to the above.

\subsection{Forward flip / backward flip}
The operation considered above modifies the number of edges of the combinatorial map.

\noindent\textbf{forward edge flip in a face}
\begin{center}\includegraphics{pictures/FlipEdge.pdf}\end{center}
Given an edge $(x,y)$ that is adjacent to distinct faces, we can perform an
"edge flip" as in the above figure.
The flip operation does neither changes the underlying set $\cE$ nor the size of the faces.

\smallskip

\noindent\textbf{forward edge flip at a vertex} there is a dual operation that consists in
performing a flip "around two vertices" instead of "at the junction of two faces".

\bigskip

\section{Translation structures}
\label{sec:TranslationStructures}
\begin{definition}
\label{def:FlatTriangulation}
Let $T = (\sigma, \alpha, \phi) \in \Sym(\cE)^3$ be a
triangulation, a \emph{translation structure} on $T$
is a family of non-zero complex numbers $\{\zeta_i\}_{i\in\cE}$
such that
\begin{enumerate}
\item for each cycle $(i,j)$ of $\alpha$ we have $\zeta_i + \zeta_j = 0$
\item for each cycle $(i_1,i_2,i_3)$ of $\phi$
the vectors $\zeta_{i_1}$, $\zeta_{i_2}$, $\zeta_{i_3}$ form the
sides of a triangle in $\CC$ where the sides appear in counter-clockwise order
(in particular $\zeta_{i_1} + \zeta_{i_2} + \zeta_{i_3} = 0$).
\end{enumerate}
\end{definition}
A translation surface is a geometrical notion and using triangulations
and the above definition is very often not enough.
For example in~\cite{veerer}, we need a more restrictive version
(related to the slopes of the vectors $\zeta_i$).
On the other hand, one might want to generalize translation structures
to cell decompositions that are not triangulations.
For now, let us consider a simple definition that is not the most
general possible but which is simple to state.
\begin{definition}
\label{def:EmbeddedTranslationStructure}
Let $M = (\sigma, \alpha, \phi) \in \Sym(\cE)$ be a combinatorial
map. An \emph{embedded translation structure} for $M$ is a zet of non-zero
complex numbers $\{\zeta_i\}_{i=1,\ldots,2n}$ such that
\begin{enumerate}
\item for each cycle $(i,j)$ of $\alpha$ we have $\zeta_i + \zeta_j = 0$
\item for each cycle $(i_1,i_2,\ldots,i_k)$ of $\phi$ the vectors
$\zeta_{i_1}$, \ldots, $\zeta_{i_k}$ form the sides of a $k$-gon in
$\CC$ where the vectors appear in counter-clockwise order.
\end{enumerate}
\end{definition}

A \emph{sub-translation structure} is one that can be obtained by forgetting
some edges (see also Section~\ref{sec:ElementaryMoves}. Because a polygon can
always be triangulated we have the following.
\begin{lemma}
Given a combinatorial map endowed with translation structure $(M,\zeta)$, there
exists a triangulation with a translation structure $(T,\zeta')$ so that $M$ is
a sub-translation structure of $(T,\zeta')$.
\end{lemma}

\subsection{Elementary moves on translation structures}
Given a combinatorial map endowed with a translation structure $(M, \zeta)$
we want to extend the elementary moves of Section~\ref{sec:ElementaryMoves}
that were operating on $M$ to the pair $(M, \zeta)$. The geometry of $\zeta$
forbids certain moves to happend.

\textbf{removing an edge / splitting a face}
Removing an edge might result in a non-embedded translation structure.
Splitting a face is always possible.

\textbf{contracting an edge / splitting a vertex}
Operations not allowed.

\textbf{forward flip / backward flip}
To perform a flip, the new edge to be added must be contained in the union of
the two faces (or in other words a saddle connection on the translation surface).
In the special cases the two adjacent faces are triangles, the condition
for flipping the edge (which is one diagonal of the quadrilateral) is that the
quadrilateral is convex.
\begin{figure}[!ht]
\begin{center}\includegraphics{pictures/QuadrilateralFlip.pdf}\end{center}
\caption{A flip in a quadrilateral.}
\end{figure}

\subsection{Delaunay triangulations and isomorphism checking}
From a translation structure on a triangulation one can compute a canonical
cell decomposition of the surface called the $\ell^2$-Delaunay decomposition.
It allows for example to solve the isomorphism problem: given two
translation surfaces given as pairs $(M,\zeta)$ and $(M',\zeta')$ are
the underlying translation surface isomorphic.

It is also possible to consider the $\ell^\infty$-Delaunay decomposition
which is very much relevant when we want to study the translation flows
in a translation surface.

\commv{These are (simple enough) but essential algorithm.
\begin{enumerate}
\item TODO: implement $\ell^2$-Delaunay, isomorphism checking and isometry group,
\item TODO: implement $\ell^\infty$-Delaunay.
\end{enumerate}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{From translation structures to interval exchange transformation}
Given a translation surface we want to study the behavior of its vertical foliations
(the foliation in any direction is relevant, but since the surface can be rotated,
we assume that we deal with the vertical). The information about the vertical
foliation can be encoded in a one-dimensional object: an interval exchange
transformation or more generally a weight on a train track.
The aim of this section is to describe an algorithm that starts from a
flat triangulation and produces an interval exchange map that encodes
the vertical foliation.

\subsection{Interval exchange transformations}
As with translation structures, interval exchange transformations are described
by a combinatorial and a continous data. More precisely by
a pair $(\pi, \lambda)$ where $\pi$ is a combinatorial data and $\lambda$ is
a continuous data.

An interval exchange is easily describe in words. Consider the interval
$I = [0,1]$. Cut it into finitely many open sub-intervals
$I_1^{top} = (0,x_1^{top})$, $I_2^{top} = (x_1^{top}, x_2^{top})$, \ldots,
$I_d^{top} = (x_{d-1}^{top}, 1)$. Rearrange the $d$ interval using a fixed
permutation $\pi$ provide a map on $[0,1]$ which is a piecewise translation.
This map is an interval exchange transformation.

\begin{figure}[!ht]
\begin{center}\includegraphics{pictures/MultiIET.pdf}\end{center}
\caption{An interval exchange transformation with $\cE^{top} = \{a,b,c,d\}$,
$\cE^{bot} = \{a',b',c',d'\}$ and $\alpha = (a,a')(b,b')(c,c')(d,d')$.
The interval exchange maps the sub-interval $I_a$ to $I_{a'}$ by
translation and similarly for the other sub-intervals.}
\label{fig:MultiIET}
\end{figure}

Let us turn to the formal definition of interval exchange transformations
We first describe the combinatorial part that we call permutation. Our definition
differs slightly from~\cite{Yoccoz} since our aim is to make clear the relation
with combinatorial maps and flat triangulations.
\begin{definition}
A \emph{permutation} on a finite set $\cE$ of cardinality $2d$, is a combinatorial
map $(\sigma, \alpha, \phi)$ together with a set partition $\cE = \cE^{top} \cup \cE^{bot}$
such that $\phi$ is a $2d$ cycle and both $\alpha$ and $\phi^d$ exchanges
$\cE^{top}$ with $\cE^{bot}$.
\end{definition}
On the example of Figure~\ref{fig:MultiIET} the permutation
\[
\left(\begin{array}{c}
a\ b\ c\ d \\
c'\ b'\ d'\ a' \\
\end{array} \right)
\]
corresponds to the combinatorial map
\begin{align*}
\alpha &= (a\ a')(b\ b')(c\ c')(d\ d') \\
\phi &= (c'\ b'\ d'\ a'\ d\ c\ b\ a)
\end{align*}
and the atoms $\cE^{top} = \{a,b,c,d\}$ and $\cE^{bot} = \{a',b',c',d'\}$.

A \emph{length data} for a permutation $\pi = (\sigma, \alpha, \phi, \cE^{top}, \cE^{bot})$
is a vector $\lambda \in \RR_{>0}^\cE$ such that $\lambda_{\alpha(e)} = \lambda_e$ for each
$e \in \cE$.

\begin{definition}
Let $\pi = (\sigma, \alpha, \phi, \cE^{top}, \cE^{bot})$ be a permutation
on $\cE$ and $\lambda \in \RR_{>0}^\cE$ be a length data.

The \emph{interval exchange transformation} associated to the pair $(\pi,\lambda)$
is the partial transformation on $I = [0, |\lambda|]$
as in Figure~\ref{fig:MultiIET} where the lengths of the subintervals are specified
by the length data.
\end{definition}

%\begin{remark}
%An alternative definition of multi-permutation is to consider an alphabet $\cA$
%with $\# \cA = \frac{1}{2} \# \cE$ that is in bijection with the orbits of
%$\alpha$. That is we have bijections $p^{top}: \cA \to \cE^{top}$ and
%$p^{bot}: \cA \to \cE^{bot}$ so that $\alpha \circ p^{top} = p^{bot}$.
%The definition we used with $(\cE, \alpha)$ is more reminiscent of
%the combinatorial map that we previously introduced. The definition with the set
%$\cA$ is used in~\cite{Yoccoz} to define iet (but he does not discuss multi-iet).
%\end{remark}

\subsection{From flat triangulation to interval exchange transformation}
Given a flat triangulation we distinguish four types of triangles.
\begin{figure}[!ht]\begin{center}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{minipage}{0.4\textwidth}
\begin{center}\includegraphics{pictures/ForwardTriangle.pdf}\end{center}
\subcaption{Forward triangle with its wide edge thicker.}
\end{minipage}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hspace{0.1\textwidth}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{minipage}{0.4\textwidth}
\begin{center}\includegraphics{pictures/BackwardTriangle.pdf}\end{center}
\subcaption{Backward triangle with its wide edge thicker.}
\end{minipage} \\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{minipage}{0.4\textwidth}
\begin{center}\includegraphics{pictures/VerticalLeftTriangle.pdf}\end{center}
\subcaption{Left vertical triangle (non vertical edges have same width).}
\end{minipage}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hspace{0.1\textwidth}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{minipage}{0.4\textwidth}
\begin{center}\includegraphics{pictures/VerticalRightTriangle.pdf}\end{center}
\subcaption{Right vertical triangle (non vertical edges have same width).}
\end{minipage}
\caption{The four types of flat triangles.}
\end{center}\end{figure}
\begin{lemma}
Let $T$ be a flat triangulation.
\begin{itemize}
\item Each triangle in $T$ is exactly of one type among forward, backward, left vertical or right vertical.
\item The number of left vertical triangles is equal to the number of right vertical triangles. More precisely, each vertical
edge has a left vertical triangle on its left and a right vertical triangle on its right.
\item The number of forward triangles is equal to the number of backward triangles.
\end{itemize}
\end{lemma}

\begin{definition}
An edge of a flat triangulation is called
\begin{itemize}
\item \emph{large} if it is the wide edge of both of its adjacent triangles (in this case
the triangle on top is backward and the triangle in the bottom is forward) or if it is the
wide edge of a triangle and its other neighboring triangle is vertical,
\item \emph{small} if it is vertical or it is the wide edge in neither of its adjacent triangles (in this latter case the triangle on top is forward and the triangle in the bottom is backward),
\end{itemize}
\end{definition}
Note that large, small and vertical are exclusive properties of edges but do
not cover all cases.

In a flat triangulation, it is always possible to flip a large edge. A
\emph{forward flip} is a flip of a large edge. After a forward flip, the large
edge becomes small. See Figure~\ref{fig:ForwardFlip}
\begin{figure}[!ht]
\begin{center}\includegraphics{pictures/QuadrilateralFlip2.pdf}\end{center}
\caption{A forward flip.}
\label{fig:ForwardFlip}
\end{figure}

% with a single purple (0):
% VeeringTriangulation("(0,~2,1)(2,~6,~3)(3,5,~4)(4,8,~5)(6,~8,~7)(7,~1,~0)", "PRBRRBBBR")

% with two purple (0 and 5)
% VeeringTriangulation("(0,~7,6)(1,~5,~2)(2,4,~3)(3,8,~4)(5,7,~6)(~8,~1,~0)", "PRBRBPRBB")

Given a large edge $e$ in a triangulation we construct a pair of connected sets
of triangles organized in form of a binary tree. The root of the top tree
$T_{top}$ is the triangle on top of the wide edge. Then we construct
recursively the tree by adding an edge $t \to t'$ between a triangle $t$
already in our tree and $t'$ if $t'$ is a backward triangle adjacent to $t$.
An example is provided in Figure~\ref{fig:TopTree}.
\begin{figure}[!ht]
\begin{center}\includegraphics{pictures/WideEdgeBinaryTree.pdf}\end{center}
\caption{The top binary tree (in blue) of a wide edge $e_0$. The top contour that consists
of the half edges $\{a_i\}_{i=1,\ldots,6}$ is coloured. Below the picture we draw the
projection of the real parts of the edges that correspond to "half" of an interval
exchange transformation.}
\label{fig:TopTree}
\end{figure}
Similarly, we construct a bottom tree $T_{bot}$ starting from the
triangle in the bottom of $e$ and gluing all forward triangles connected
to it.

\begin{lemma}
Let $T$ be a flat triangulation without vertical edges.
Then the set of bottom and top trees attached to large edges
form a partition of the triangles of $T$.

If moreover there is a single large edge in $T$, then the top contour
of the top tree and the bottom contour of the bottom tree form an interval exchange
transformation where the widths of the sub-intervals are given by the
real parts of these edges.
\end{lemma}

\textbf{Algorithm (assuming we do not encounter vertical edges):}
\begin{enumerate}
\item Fix a large edge $e_1$ in the triangulation $T$.
\item while there is another large edge $e' \not= e_1$ flip it
\end{enumerate}

In the case where there is a vertical saddle connection we also
flip large edges as in Figure~\ref{fig:ForwardFlipWithVertical}.
\begin{figure}[!ht]
\begin{center}\includegraphics{pictures/ForwardFlipWithVertical.pdf}\end{center}
\caption{A sequence of forward flip through a family of vertical triangles.}
\label{fig:ForwardFlipWithVertical}
\end{figure}
Though, we need to add one more check in the algorithm since vertical saddle
connections are never flipped and might disconnect the surface, see Figure~\ref{fig:VerticalDisconnecting}.
\begin{figure}[!ht]
\begin{center}\includegraphics{pictures/VerticalDisconnecting.pdf}\end{center}
\caption{The two vertical saddle connections corresponding to the edges $(5,6)$ and $(9,10)$
disconnect the surface.}
\label{fig:VerticalDisconnecting}
\end{figure}

\noindent \textbf{Algorithm}
\begin{itemize}
\item Fix a large edge $e_1$ in the triangulation $T$
\item While there is another large edge $e' \not= e_1$ flip it.
If the new edge after a flip is vertical, check whether the vertical saddle
connections disconnect the surface. If they do, then for each connected component
$i$ which is not a cylinder, choose a large edge $e_1^{(i)}$ for inducing and
run the algorithm independently in each subsurface.
\end{itemize}

\subsection{Dynamical decomposition of interval exchange transformation}

As we have seen an interval exchange transformation is just one way to represent
a translation surface with discrete data. We now explain how to decompose an
interval exchange transformation into periodic and minimal components.

Separatrices are canonically labeled by the interval on their left as in
Figure~\ref{fig:LabellingSeparatricesIET}.
\begin{figure}[!ht]
\begin{center}
\includegraphics{pictures/LabellingSeparatricesIET.pdf} \\
%\includegraphics{pictures/SeparatrixDiagram-1-2.pdf}\\
\includegraphics{pictures/Connection-2.pdf}%
\hspace{0.5cm}%
\includegraphics{pictures/LabellingSeparatricesIET-2.pdf} \\
%\includegraphics{pictures/SeparatrixDiagram-2-3.pdf}\\
\includegraphics{pictures/Connection-3.pdf}%
\hspace{0.5cm}%
\includegraphics{pictures/LabellingSeparatricesIET-3.pdf} \\
\includegraphics{pictures/Connection-4.pdf}%
\hspace{0.5cm}%
\includegraphics{pictures/LabellingSeparatricesIET-4.pdf}
\end{center}
\caption{Discovering the periodic components of an interval exchange transformation
on five intervals. In the end, we obtain a decomposition made of 3 connections
($(s^+_D, s^-_B)$, $(s^+_A, s^-_C)$, $(s^+_E, s^-_D)$),
a minimal component (on letters $\{A, C\}$) and a cylinder (on letter $E$).}
\label{fig:LabellingSeparatricesIET}
\end{figure}

%\subsection{From triangulations with translation structures to multi-interval exchange transformations}
%Let $M = (\sigma, \alpha, \phi)$ be a triangulation on
%the finite set $\cE$ and $\zeta \in \CC^\cE$ a translation structure for $M$.
%We associate to this pair a multi-interval exchange on
%$n_f$-intervals where $n_f$ is the number of triangles in $M$.
%
%Each triangle $(i,j,k)$ in $M$ can be drawn in the plane and has a left-most and
%a right-most vertex. This decomposes its sides into a top and a bot partition.
%See Figure~\ref{fig:FromTrianglesToIntervals}
%\begin{figure}[!ht]
%\begin{minipage}{0.4\textwidth}
%\begin{center}
%\includegraphics{pictures/TriangleToInterval1.pdf}
%\end{center}
%\end{minipage}
%\hspace{.1\textwidth}
%\begin{minipage}{0.4\textwidth}
%\begin{center}
%\includegraphics{pictures/TriangleToInterval2.pdf}
%\end{center}
%\end{minipage}
%\caption{From a triangle (with its separatrix) to an interval.}
%\label{fig:FromTrianglesToIntervals}
%\end{figure}
%
%Note that the length data of the multi-interval exchange transformation is
%simply the vector of absolute values of real parts of the vectors $\zeta_i$.
%In this correspondence:
%\begin{itemize}
%\item an edge of the combinatorial map is in bijection with a pair of intervals
%$(I^{top}_{j,i}, I^{bot}_{j',i'})$ such that the multi-iet maps $I^{top}_{j,i}$
%to $I^{bot}_{j',i'}$.
%\item the outgoing/incoming vertical separatrices in the translation surface are
%in bijections with the singularities of $T$ respectively $T^{-1}$
%\end{itemize}
%
%\subsection{From multi-iet to iet}
%We already described how a translation structure on a triangulation gave rise to a
%multi-iet. We now explain how to reduce a multi-iet to an iet, that is
%a multi-iet on a single interval. For that purpose, we use two operations.
%A gluing operation that allows to paste several
%intervals together and an induction very similar to
%Rauzy induction for iet (see~\cite{Yoccoz} for the latter).
%\begin{definition}
%Let
%$\pi = \{(\cE^{top}_j, \pi^{top}_j, \cE^{bot}_j, \pi^{bot}_j\}_{j=1,\ldots,m}\}$
%be a multi-permutation.
%Assume that there are two distinct subintervals $j_1, j_2 \in \{1,\ldots,m\}$ such
%that the bottom right symbol of the interval $j_1$ is paired with the top left
%symbol of the interval $j_2$. That is if $i \defeq (\pi^{bot}_{j_1})^{-1}(d_{j_1}^{bot})$
%and $i' \defeq (\pi^{top}_{j_2})^{-1}(1)$ satisfy $\alpha(i) = i'$.
%
%The \emph{gluing of $j_1$ and $j_2$ along $(i, i')$} is the new multi-permutation
%on $m-1$ intervals obtained by merging the two components $j_1$ and $j_2$ and forget
%about $(i, i'$). If we had
%\[
%\pi_{j_1} = \left( \begin{array}{c}
%A_1 \\
%B_1\ i
%\end{array} \right)
%\qquad \text{and} \qquad
%\pi_{j_2} = \left( \begin{array}{c}
%i'\ A_2 \\
%B_2 \\
%\end{array} \right)
%\]
%Then the new component after gluing is
%\[
%\left( \begin{array}{c}
%A_1\ A_2 \\
%B_1\ B_2
%\end{array} \right).
%\]
%\end{definition}
%A gluing can be seen on Figure~\ref{fig:MIETGluing}.
%\begin{figure}[!ht]
%\begin{center}\includegraphics{pictures/MultiIETInduction.pdf}\end{center}
%\caption{A gluing operation along $(g,g')$ on a multi-iet.}
%\label{fig:MIETGluing}
%\end{figure}
%
%\begin{definition}
%Let
%$\pi = \{(\cE^{top}_j, \pi^{top}_j, \cE^{bot}_j, \pi^{bot}_j)\}_{j=1,\ldots,m}$
%be a multi-permutation and $\lambda \in \RR_{>0}^{\cE}$ an associated
%length data.
%
%Let $j \in \{1,\ldots,m\}$ and consider the right-most subintervals of
%the $j$-th interval, that is $i^{top} \defeq (\pi^{top}_j)^{-1}(d_j^{top})$
%and $i^{bot} \defeq (\pi^{bot}_j)^{-1}(d_j^{bot})$.
%
%The \emph{right Rauzy induction on the $j$-th component} consists in inducing
%the multi-interval exchange transformation after removing the smallest of
%the two sub-intervals corresponding to $i^{top}$ or $i^{bot}$.
%\end{definition}
%
%\commv{TODO: implement the reduction algorithm that consists in reducing
%a multi-iet to an iet via
%\begin{enumerate}
%\item if a gluing is available, do it
%\item if there is none, perform Rauzy inductions until there is one
%\end{enumerate}}
%
%\subsection{Saddle connections and cylinders}
%The procedure we described so far works if there is no vertical saddle connections.
%When there are, it might be impossible to construct an iet. Even worse, a vertical
%edge is not properly encoded. In this section we discuss how to solve the issues.
%
%\begin{definition}[reducible multi-permutation]
%cumbersome.
%\end{definition}
%
%It might happen that along the inductionPerforming Rauzy induction we detect some saddle connection,
%that is we might have $\lambda_{i^{bot}} = \lambda_{i^{top}}$. In that case, the
%saddle connection should be stored for future use and the two sub-intervals must be
%fusionned. To do that, a fixed labelling of the separatrix has to be chosen at
%the begining.
%
%\subsection{What is a zippered rectangle?}
%\begin{definition}
%\label{def:WeakZipperedRectangle}
%Let $\cE$ be a finite set of cardinality $2d$.
%A \emph{topological zippered rectangle} is a combinatorial map $(\sigma, \alpha, \phi) \in \Sym(\cE)^3$ such that
%\begin{enumerate}
%\item $\phi$ is a $2d$-cycle (that is the cell decomposition consists of a single cell),
%\item there is a partition of $\cE^{top} \cup \cE^{bot} = \cE$ such that the
%involutions $(\phi)^d$ and $\alpha$ exchanges $\cE^{top}$ and $\cE^{bot}$.
%\end{enumerate}
%A \emph{weak zippered rectangle translation structure} for $(\sigma, \alpha, \phi)$ is
%a set of complex non-zero vectors $\zeta_i$ such that
%\[
%\forall i \in \cE^{bot}, \Re(\zeta_i) \geq 0
%\qquad
%\forall i \in \cE^{top}, \Re(\zeta_i) \leq 0.
%\]
%\end{definition}
%Note that the above definition only involves the real parts of the vectors $\zeta_i$.
%What is missing to make it a zippered rectangle is a condition on imaginary parts
%that correspond the equation $(S_\pi)$ in~\cite{Yoccoz} on the suspension vector. For
%our purpose, this condition is useless and let us ignore it for the moment.
%\begin{figure}[!ht]
%\begin{center}\includegraphics{pictures/MasurPolygon.pdf}\end{center}
%\caption{A zippered rectangle translation structure with combinatorial data
%$\sigma = (0,7,14,1,16,11,4,17)$ or
%$\alpha = (0,16)(1,17)(7,11)(4,14)$ and
%$\phi = (0,1,4,7,16,17,14,11)$. Here $\cE^{top} = \{0,11,14,17\}$ and $\cE^{bot} = \{4,7,16,17\}$. It is depicted as a sub-translation structure of an embedded triangulation.}
%\label{fig:TriangulationYoccoz}
%\end{figure}
%
%The triangulations in Figure~\ref{fig:TriangulationYoccoz} is
%\begin{align*}
%\sigma &= (0,3,6,9,7,5,14,15,1,16,13,10,8,11,12,4,2,17) \\
%\alpha &= (0,16)(1,17)(2,3)(4,14)(5,6)(7,11)(8,9)(10,12)(13,15) \\
%\phi &= (0,1,2)(3,4,5)(6,7,8)(9,10,11)(12,13,14)(15,16,17)
%\end{align*}
%Here is a code sample to it with \cite{surface-dynamics}
%\begin{verbatim}
%sage: from surface_dynamics import FatGraph
%sage: edges = '(0,16)(1,17)(2,3)(4,14)(5,6)(7,11)(8,9)(10,12)(13,15)'
%sage: faces = '(0,1,2)(3,4,5)(6,7,8)(9,10,11)(12,13,14)(15,16,17)'
%sage: FatGraph(ep=edges, fp=faces)
%FatGraph('(0,3,6,9,7,5,14,15,1,16,13,10,8,11,12,4,2,17)',
%'(0,16)(1,17)(2,3)(4,14)(5,6)(7,11)(8,9)(10,12)(13,15)',
%'(0,1,2)(3,4,5)(6,7,8)(9,10,11)(12,13,14)(15,16,17)')
%\end{verbatim}
%
%Now, given a topological zippered rectangle $(\sigma, \alpha, \phi)$ we describe
%how to construct the bijections $\pi_t:\cA \to \{1,\ldots,d\}$ and $\pi_b: \cA \to \{1,\ldots,d\}$ of~\cite{Yoccoz}.
%Let $\cA$ be the set of the $d$ transpositions that appear in the cycle decomposition
%of $\alpha$ (these are the edges of the combinatorial map). Then by the second
%condition, $\cE^{top}$ and $\cE^{bot}$ are in canonical bijections with $\cA$: to an
%half-edge $i$ associates the unique transposition in $\cA$ that contains $i$.
%Next, there is a unique way to write $\phi$ as
%\[
%\phi = (b_1, b_2, \ldots, b_d, t_d, t_{d-1}, \ldots, t_1)
%\]
%where $\cE^{bot} = \{b_1, \ldots, b_d\}$ and $\cE^{top} = \{t_1, \ldots, t_d\}$.
%Then, for $\alpha = (t_i, b_j) \in \cA$ we set $\pi_t(\alpha) = i$ and $\pi_b(\alpha) = j$.
%
%In the example of Figure~\ref{fig:TriangulationYoccoz}, we have
%\[
%t_1 = 0,\ t_2 = 11,\ t_3 = 14,\ t_4 = 17
%\qquad
%b_1 = 1,\ b_2 = 4,\ b_3 = 7,\ b_4 = 16
%\]
%
%\subsection{Naive version}
%\textit{(discussed on April 22)}
%
%Pick an edge and build the first return map to this edge.
%For that purpose, follow the (vertical) translation flow until it comes back to this edge.
%


%The first step is to build a multi-interval exchange
%transformation out of a triangulation. Each triangle
%will correspond to an interval of the transformation
%and each edge will correspond to a subinterval of the
%transformation.
%
%Each triangle $(a,b,c)$ gives rise of two possible type
%of interval. Either
%\[
%\begin{array}{l}
%b\ a \\
%c
%\end{array}
%\qquad \text{or} \qquad
%\begin{array}{l}
%a \\
%b\ c
%\end{array}
%\]
%We call the first kind bottom-dominant and the second top-dominant.
%
%For each of these intervals, we can forget about the big edge and glue it
%to where it is glued. That diminish the number of intervals under consideration. In
%geometric terms, it corresponds to remove some of the edges of the triangulations.
%
%Another possible bootstrap option: start at a given vertex and look at the horizontal in the right
%direction. We start crossing triangles and we stop at the time we meet a triangle that we already
%encountered. Then remove all edges that are crossed by this horizontal piece. This makes a nice "Masur polygon".
%And we should start again from another vertex until we get rid of all the triangles.
%


\section{$\GL(2,\bR)$-orbit closures}

\subsection{The tangent space to a translation surface and homology groups}
Let $T$ be a combinatorial triangulation. We assume that each edge comes with
a fixed orientation and number them from $1$ to $d$.

Recall that a translation structure on $T$ is given by a vector $\zeta$
in $\bC^d$ that satisfies two constraints
\begin{enumerate}
\item the sum around triangles is zero
\item the orientation of each triangle is correct
\end{enumerate}
The neighborhood of this surface is described by the surfaces $(T, \zeta + v)$
where $v \in \bC^d$ satisfy the condition that the sum around each triangle is
zero. We denote $V(T) \subset \bR^d$ the vector subspace of vectors that
satisfy the triangle relations.

\begin{figure}[!ht]
\begin{center}%
\includegraphics{pictures/H11_skeleton.pdf}%
\hspace{1cm}%
\includegraphics{pictures/H11_skeleton-bis.pdf}%
\end{center}
\caption{A surface in $\cH(1,1)$ made of 8 triangles. The two pictures represent the
same surface but with different choices of spanning tree for the dual graph that
give rise to different bases of $V(T)$. The first gives $\{e_1, e_2, e_3, e_4, e_5\}$
while the second one gives $\{e_3, e_5, e_6, e_7, e_{12}\}$. The associated dual basis
are also displayed in colors.}
\label{fig:H11skeleton}
\end{figure}

On Figure~\ref{fig:H11skeleton}, there is a surface made of 8 triangles and
12 edges. Denoting the canonical basis of $\bR^{12}$ by $e_1$, \ldots, $e_{12}$
the triangle relations are
\begin{align*}
-e_1 + e_6 - e_2 &= 0 \\
e_1 - e_6 + e_7 &= 0 \\
-e_7 + e_8 + e_9 &= 0 \\
e_2 - e_8 - e_3 &= 0 \\
-e_4 - e_9 + e_{10} &= 0 \\
e_3 - e_{10} + e_{11} &= 0 \\
e_5 - e_{11} + e_{12} &= 0 \\
e_4 - e_{12} - e_{5} &= 0
\end{align*}

\begin{lemma}
Let $T$ be a combinatorial triangulation with $d$ edges. The sum of triangle
relations is zero and it is the only relation between them. In particular,
$V(T)$ has codimension equal to the number of faces minus one.

For any spanning tree of the dual graph to $T$, the set of vectors associated to the
complement of the edges of the spanning tree form a basis of $V(T)$.
\end{lemma}

On Figure~\ref{fig:H11skeleton}, we choose as a basis of $V(T)$ the vectors
$e_1$, $e_2$, \ldots, $e_5$. Note that $5 = 12 - (8 - 1)$.

\subsection{The space $V(T)$ and homology groups}
Let $(T, \zeta)$ be a translation surface given by a triangulation. We denote
by $S$ the underlying compact topological surface and $\Sigma \subset S$ the
set of conical points (corresponding to the vertices of the flat
triangulation). The homology group of the surface is what already appears as
our space $V(T)$ in the previous section. More precisely, to a fixed
translation structure we can associate its \emph{period map}
\[
H_1(S, \Sigma; \bZ) \to \bC
\]
which is the extension to $H_1(S, \Sigma; \bZ)$ of the map consisting of associating to
an edge $e$ its corresponding vector $\zeta_e$.
\begin{lemma}
Let $T$ be a triangulation and let $S$ be the underlying topological surface
with vertex set $\Sigma$. Then we have a canonical identification
$V(T) \simeq H^1(S, \Sigma; \bR)$.
\end{lemma}

There are three homology groups of interest on the surface $S$.
\begin{itemize}
\item The relative homology group $H_1(S, \Sigma; \bZ)$ (which we already saw corresponds to the integer points in $V(T)$),
\item the absolute homology group $H_1(S; \bZ)$,
\item the homology of the punctured surface $H_1(S \setminus \Sigma; \bZ)$.
\end{itemize}

What is important to notice is that $H_1(S, \Sigma; \bZ)$ and $H_1(S \setminus
\Sigma; \bZ)$ are dual to each other. In other words, $V(T)$ also identifies
to $H_1(S \setminus \Sigma; \bZ)$. To see that, we just consider the dual
combinatorial map to the triangulation $T$ as considered in
Section~\ref{sec:TriangulationsAndTranslationStructures}. An element of
$V(T)$ can be considered as weights put on the edges of this dual.
The condition that the sum around a vertex of the dual is zero,
is precisely the condition for being in the homology.

\begin{lemma}
\label{sec:VT:dual}
The space $V^*(T)$ corresponds to the quotient
\[
\bR^{E(T)} / \{\text{triangle relations}\}
\]
and is canonically identified with $H_1(S, \Sigma; \bR)$.
\end{lemma}

More abstractly, the homology groups come together with (dual) exact sequences
\begin{align}
0 \to H_1(S; \bZ) \to H_1(S, \Sigma; \bZ) \to C^0(\Sigma) \to 0 \\
0 \to C_0(\Sigma) \to H_1(S \setminus \Sigma; \bZ) \to H_1(S; \bZ) \to 0
\end{align}
where
\[
C^0(\Sigma) = \left\{(m_s)_s \in \bZ^\Sigma: \sum_{s\in\Sigma} m_s = 0 \right\}
\quad \text{and} \quad
C_0(\Sigma) = \bZ^\Sigma / \bZ (1,1,\ldots,1).
\]
Here the map $H_1(S, \Sigma; \bZ) \to C^0(\Sigma)$ corresponds to the boundary map
(to a curve we associate the difference of its endpoints). While the subspace $C_0(\Sigma)$
of $H_1(S \setminus \Sigma; \bZ)$ corresponds to the curves generating by loops around the
punctures. The duality between the two exact sequences is induced via the intersection pairing
\[
\langle .,. \rangle: H_1(S, \Sigma; \bZ) \times H_1(S \setminus \Sigma; \bZ) \to \bZ.
\]

\subsection{Following tangent vectors}
Given a combinatorial triangulation $T$ the set of valid translation structures $(\zeta_e)_{e \in E(T)}$
are subject to the following two conditions:
\begin{itemize}
\item the sum of holonomy vectors around a face is zero,
\item the holonomies of two neighbor half edges at a vertex have positive determinant.
\end{itemize}
The first condition is a linear equation while the second is a quadratic inequality.
In other words the set of valid translation structures is a semi-algebraic variety
in $(\bR^2)^{E(T)}$ which might not be connected.

\textbf{Warning:} This semi-algebraic set is not always connected!

Given a translation structure $\zeta$ the nearby translation structures are $\zeta + w$
where $w \in V(T) + i V(T)$ is small enough. The aim of this section is to
explain how to check whether $\zeta + w$ is a valid deformation. Note
that both $\zeta$ and $\zeta + w$ might belong to the semi-algebraic set of valid
translation structures but the path $(\zeta + t w)_{t \in [0,1]}$ is not contained
in it and thus $\zeta + w$ is not a valid deformation.
\begin{lemma}
Let $T$ be a combinatorial triangulation, $\zeta = x + i y$ a
translation structure and $w = u + i v$ a deformation vector such
that $\zeta + w$ is also a translation structure. For each
pair of adjacent half edges $e$, $e'$ at a vertex let
\begin{align*}
a_{e,e'} &= u_e v_{e'} - u_{e'} v_e \\
b_{e,e'} &= -u_e y_{e'} + u_{e'} y_e - x_e v_{e'} + x_{e'} v_e \\
c_{e,e'} &= x_e y_{e'} - x_{e'} y_e \\
\end{align*}
    Then $(T, \zeta + w)$ is a valid deformation of $(T, \zeta)$ if and only if for all pair of adjacent half edges at a vertex $e, e'$ with $a_{e,e'} = 0$ we have 
\[
c_{e,e'} > 0
\quad \text{and} \quad
c_{e,e'} > b_{e,e'}
\]
and for those with $a_{e,e'} > 0$ we have
\[
b_{e,e'} < 0
\quad \text{or} \quad
b_{e,e'} > 2a_{e,e'}
\quad \text{or} \quad
b_{e,e'}^2 - 4 a_{e,e'} c_{e,e'} < 0.
\]
\end{lemma}

\begin{proof}
We want each determinant of adjacent half edges to remain positive. Let
$e$ and $e'$ be two adjacent half edges, then
\begin{align*}
p(t) \defeq \det(\zeta_{e}(t), \zeta_{e'}(t))
&= \det
\begin{pmatrix}
x_e + t u_e & x_{e'} + t u_{e'} \\
y_e + t v_e & y_{e'} + t v_{e'}
\end{pmatrix}
\\
&=  (x_e + t u_e)(y_{e'} + t v_{e'}) - (x_{e'} + t u_{e'})( y_e + t v_e) \\
&= t^2 (u_e v_{e'} - u_{e'} v_e) + t (u_e y_{e'} + x_e v_{e'} - x_{e'} v_e - u_{e'} y_e)
+ x_e y_{e'} - x_{e'} y_e \\
&= a_{e,e'}t^2 - b_{e,e'}t + c_{e,e'}.
\end{align*}
The critical point of the above quadratic polynomial is just $m = b_{e,e'} / (2 a_{e,e'})$.
By assumption, $p(0)$ and $p(1)$ are positive. So it remains positive all along if and
only if the critical value $\frac{-b_{e,e'}^2 + 4a_{e,e'}c_{e,e'}}{4 a_{e,e'}}$ is
positive or the critical point is outside the interval $[0,1]$.
\end{proof}


\subsection{Base changes between two triangulations}
Let $M = (T, \zeta)$ be a translation surface given by a flat triangulation. If
$C$ is a (flat) cylinder on $M$, then its core curve can be considered as an
element of $H_1(S, \Sigma; \bZ) \simeq V_\bZ(T)$. In order to apply the
results of the next section, we need to be able to compute this element.
By compute we mean that the cylinder will often be computed in an other
basis $(T', \zeta')$ of the same underlying surface.

More precisely we have two triangulations $(T,\zeta)$ and $(T',\zeta')$ of the
same translation surface and each edge of the triangulation $T'$ corresponds to
a certain linear combination of edges for the initial triangulation $T$. This
identification can be seen as a linear map $H_1(S, \Sigma; \bZ) \to H_1(S,
\Sigma; \bZ)$, or in other words a linear map
\begin{equation}
\label{eq:KZcocycle}
A^*(T',T): V^*(T') \to V^*(T).
\end{equation}
In most algorithms, we actually build a lift $\widetilde{A}(T',T): \bR^{E(T')} \to \bR^{E(T)}$
that pass to the quotient (see Lemma~\ref{sec:VT:dual}).

\begin{lemma}
Let $(T, \zeta)$ and $(T', \zeta')$ be two translation surfaces where $(T',\zeta')$
is obtained from $(T,\zeta)$ by a sequence of flips and let $A^*(T',T): V^*(T') \to V^*(T)$
the associated map on homology as in~\eqref{eq:KZcocycle}. Let $\zeta \in V(T')$ be an element of $H_1(S, \Sigma; \bZ)$
expressed in the $T'$ basis, then its expression in the $T$ basis is
$A(T',T)^{-1} \zeta$ where $A(T',T): V(T) \to V(T')$ is the transposed map of $A^*(T',T)$.
\end{lemma}

\begin{proof}
In order to check that two elements of $H^1(S, \Sigma; \bZ)$ are equal it suffices to check
that they evaluate identically on any element in $H_1(S, \Sigma; \bZ)$. Now a base change
corresponds to a certain conjugation. When we pass to the dual base change we see
a transpose inverse matrix.
\end{proof}

An example of such map is provided with Figure~\ref{fig:H11skeleton}. In order to make
it easier we denote with primes the element of the basis on the right hand side. The
bases of $V(T)$ are respectively $\{e_1, e_2, e_3, e_4, e_5\}$ and
$\{e'_3, e'_5, e'_6, e'_7, e'_{12}\}$ with base changes
\[
\begin{pmatrix}
e'_3 \\
e'_5 \\
e'_6 \\
e'_7  \\
e'_{12}
\end{pmatrix}
=
\begin{pmatrix}
0 & 0 & 1 & 0 & 0 \\ % e_3
0 & 0 & 0 & 0 & 1 \\ % e_5
1 & 1 & 0 & 0 & 0 \\ % e_1 + e_2
0 & 1 & 0 & 0 & 0 \\ % e_2
0 & 0 & 0 & 1 & -1 \\ % e_4 - e_5
\end{pmatrix}
\begin{pmatrix}
e_1 \\
e_2 \\
e_3 \\
e_4 \\
e_5 \\
\end{pmatrix}
\qquad \text{and} \qquad
\begin{pmatrix}
e_1 \\
e_2 \\
e_3 \\
e_4 \\
e_5 \\
\end{pmatrix}
=
\begin{pmatrix}
% 3 & 5 & 6 & 7 & 12
  0 & 0 & 1 & -1 & 0 \\ % e'_6 - e'_7
  0 & 0 & 0 & 1 & 0 \\ % e'_7
  1 & 0 & 0 & 0 & 0 \\ % e'_3
  0 & 1 & 0 & 0 & 1 \\ % e'_5 + e'_{12}
  0 & 1 & 0 & 0 & 0 \\ % e'_5
\end{pmatrix}
\begin{pmatrix}
e'_3 \\
e'_5 \\
e'_6 \\
e'_7  \\
e'_{12}
\end{pmatrix}
\]
The corresponding base changes for the dual bases $\{\zeta_i\}$ and
$\{\zeta'_i\}$ are given by the transpose inverse
\[
\begin{pmatrix}
\zeta_1 \\
\zeta_2 \\
\zeta_3 \\
\zeta_4 \\
\zeta_5
\end{pmatrix}
=
\begin{pmatrix}
0 & 0 & 1 & 0 & 0 \\
0 & 0 & 1 & 1 & 0 \\
1 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 1 \\
0 & 1 & 0 & 0 & -1
\end{pmatrix}
\begin{pmatrix}
\zeta'_3 \\
\zeta'_5 \\
\zeta'_6 \\
\zeta'_7  \\
\zeta'_{12}
\end{pmatrix}
\qquad \text{and} \qquad
\begin{pmatrix}
\zeta'_3 \\
\zeta'_5 \\
\zeta'_6 \\
\zeta'_7  \\
\zeta'_{12}
\end{pmatrix}
=
\begin{pmatrix}
0 & 0 & 1 & 0 & 0 \\
0 & 0 & 0 & 1 & 1 \\
1 & 0 & 0 & 0 & 0 \\
-1 & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0
\end{pmatrix}
\begin{pmatrix}
\zeta_1 \\
\zeta_2 \\
\zeta_3 \\
\zeta_4 \\
\zeta_5
\end{pmatrix}
\]

\subsection{$\GL(2,\bR)$-action and linear manifolds}
The $\GL(2,\bR)$ action on the space of translation surfaces is given in our
coordinates by the linear action on $\bC$ identified to $\bR^2$. Even more
precisely, writing $\zeta = (x_1 + i y_1, x_2 + i y_2, \ldots, x_d + i y_d)$ we have
\[
\begin{pmatrix}
\alpha & \beta \\
\gamma & \delta
\end{pmatrix}
\cdot
\begin{pmatrix}
x_1 & x_2 & \ldots & x_d \\
y_1 & y_2 & \ldots & y_d
\end{pmatrix}
=
\begin{pmatrix}
\alpha x_1 + \beta y_1 & \alpha x_2 + \beta y_2 & \ldots & \alpha x_d + \beta y_d \\
\gamma x_1 + \delta y_1 & \gamma x_2 + \delta y_2 & \ldots & \gamma x_d + \delta y_d
\end{pmatrix}
\]
To understand the $\GL(2,\bR)$-action, a first step is to get a clue on what
are the closed invariant subsets. The Eskin-Mirzakhani structural theorem
says that these are very rigid.
\begin{definition}
A \emph{linear submanifold} of translation surfaces is a closed subspace of the
space of translation surfaces that is locally at a point $(T, \zeta)$ described
by linear equations in the coordinates $V(T) \times V(T)$.
(this is a lie as we allow self-intersection that do not matter for our purpose)
\end{definition}

\begin{theorem}[Eskin-Mirzakhani, Eskin-Mirzakhani-Mohammadi]
Let $\cM$ be a $\GL(2,\bR)$-invariant closed subset of translation surfaces. Then
$\cM$ is a linear submanifold (with possibly self intersections).
\end{theorem}

The main algorithmic question we want to deal with is: given a surface $(T, \zeta)$
(or possibly a family of such surfaces) what is its $\GL(2,\bR)$-orbit closure? As the
above theorem states, such orbit closure is simply described by the tangent space
at a single point!

The object we want to deal in the algorithm are pairs $((T,\zeta), U)$
consisting of a translation surface $(T,\zeta)$ and a subspace of $V(T) \times
V(T)$ that describe the infinitesimal deformations of $(T, \zeta)$.
The first important remark is the $\GL(2,\bR)$-invariance can be read on $U$.
\begin{lemma}
Let $\cM$ be a submanifold of translation surfaces. Then, it is
$\GL(2,\bR)$-invariant, if and only if, at any point $(T, \zeta)$ its tangent
space in $V(T) \times V(T)$ is a direct sum $U \oplus U$ where $U \subset V(T)$
is a vector subspace and $U$ contains both $\Re(\zeta)$ and $\Im(\zeta)$.
\end{lemma}

\begin{proof}
Just use the fact that the real projection $x+iy \mapsto x$ and imaginary projection
$x+iy \mapsto y$ leave the tangent space invariant (since they are limit of $\GL(2,\bR)$
elements).
\end{proof}

In other words, instead of having to deal with subspaces of $V(T) \oplus V(T)$ we only
care about subspaces of $V(T) \subset \bR^d$. The infinitesimal deformations around $(T,\zeta)$ are
then given by $(T, \zeta + u + i v)$ where $u, v \in V(T)$.

If our starting point is a single surface $(T, \zeta)$, we already obtain
non-trivial subspace of the tangent space, namely $\bR \Re(\zeta) \oplus \bR
\Im(\zeta) \subseteq V(T)$.

\subsection{The field of definition}
Here we describe some algebraic results due to Alex Wright. Let us note that
$V(T) \subset \bR^d$ is canonically endowed with a $\bZ$-structure (vectors
whose coordinates are integrals). Because of this, it makes sense to consider
the \textit{field of definition} of a linear subspace in $V(T)$.
\begin{theorem}[Alex Wright~\cite{Wright-field-of-def}]
Let $\cM$ be a (linear) $\GL(2,\bR)$-invariant manifold of translation surfaces.
Then there exists a totally real number field $k = k(\cM)$ whose degree satisfies
$[k : \bQ] \leq g$ such that at any point $(T,\zeta)$ the field of definition
of the "half-tangent space" $U \subset V(T)$ is $k$.
\end{theorem}
The important feature of this theorem is that if the subspace $U$ contains
some transcendental numbers they can be "killed". For example, let us assume
that $V = \bR^3$ and that we have a line of deformations $U = (1, s, 2s+1) \bR \subset V$
where $s$ is transcendental. Then the above result implies that the tangent
space to the $\GL(2,\bR)$-invariant manifold contains $(1, 0, 1) \bR \oplus (0,
1, 2) \bR$.

Here is another possibly useful result.
\begin{theorem}[Alex Wright~\cite{Wright-field-of-def}]
Let $\cM$ be a (linear) $\GL(2,\bR)$-invariant manifold. Then $\cM$ contains a
translation surface $(T,\zeta)$ whose horizontal flow is completely periodic.
Moreover, its number of cylinders $m$ satisfies $m \geq [k(\cM) : \bQ]$ where $k(\cM)$
is the field of definition of $\cM$.
\end{theorem}

\subsection{Horocycle action}
The next two results concern the action of the horocycle flow
\[
H = \left\{\begin{pmatrix}
1 & s \\
0 & 1
\end{pmatrix}: s \in \bR \right\}.
\]
\begin{theorem}[essentially Ratner]
Let $(T, \zeta)$ be a translation surface and let us suppose that its
horizontal direction is completely periodic, that is, it decomposes into
a finite union of cylinders. Then the orbit closure of $H$-orbit of
$(T,\zeta)$ is a torus. If $w_1, \ldots, w_m$ and
$h_1, h_2, \ldots, h_m$ denote respectively the widths and heights of
the cylinders then this torus is canonically identified to the orbit
closure in $\bR^m \ (\bR w_1 e_1 \oplus \bR w_2 e_2 \oplus \ldots \oplus w_m e_m)$
of the flow $F^t: (u_1, u_2, \ldots, u_m) \mapsto (u_1 + t h_1, u_2 + t h_2, \ldots, u_m + t h_m)$
where $(e_i)_{i=1,\ldots,m}$ is the canonical basis of $\bR^m$.
\end{theorem}
This proposition is effective in the sense that to compute this torus, it is
enough to know the linear relations among the ratios $\mu_i = h_i / w_i$
(called the moduli). In particular, when all these moduli are commensurable
(ie $\dim_\bQ \bQ \mu_1 + \bQ \mu_2 + \ldots + \bQ \mu_m = 1$) then this
torus is one-dimensional.

We finally introduce the main tool we want to use which are the cylinder deformations.
\begin{theorem}[Alex Wright~\cite{Wright-cylinder-deformations}]
Let $\cM$ be a (linear) $\GL(2,\bR)$-invariant manifold and $(T,\zeta)$ be a surface
in $\cM$ whose horizontal flow contains at least one cylinder. Let $C_1$, \ldots, $C_m$
be the set of cylinders in the horizontal direction (they need not fill the surface).
Let $\gamma_1$, \ldots, $\gamma_m$ be the waist curves of these cylinders, $w_1$, \ldots, $w_m$
their widths and $h_1$, \ldots, $h_m$ their heights.
Each waist curve cross the edges of the triangulation and we denote by $v(\gamma_i) \in V_\bZ(T)$ the
intersection vector (be careful about signs). Then the vector
\[
h_1 v(\gamma_1) + h_2 v(\gamma_2) + \ldots + h_m v(\gamma_m) \in V(T)
\]
is in the tangent space to $\cM$.
\end{theorem}

\section{Detecting coverings}
We are given a translation surface $S$ and would like to detect whether it comes from a ramified
covering $f: S \to S'$. Here we also want to consider whether the surface $S$
admits an affine symmetry with derivative $-1$, ie whether it comes from the
canonical double covering of a quadratic differential.

For both problems, the main strategy is to compute the Delaunay cell
decomposition of $S$ and look for symmetries in it. There is a delicate
issue about the appropriate choice of vertices $\Sigma \subset S$ to
compute the appropriate Delaunay cell decomposition as $\Sigma$ might
need to contain regular points of the translation structure.

\subsection{Combinatorics}
Let us recall that we encode a cell decomposition of a topological surface by
a triple of permutations $(\sigma, \alpha, \phi)$.
\begin{definition}
A \emph{combinatorial covering}
between two combinatorial maps $M = (\sigma, \alpha, \phi)$ and
$M' = (\sigma', \alpha', \phi')$ in respectively $S_n$ and $S_{n'}$
is a map $\pi: \{1, 2, \ldots, n\} \to \{1, 2, \ldots, n'\}$ such that
\begin{itemize}
\item
$\forall i \in \{1,2,\ldots,n\}$ we have
$\sigma'(\pi(i)) = \pi(\sigma(i))$, $\alpha'(\pi(i)) = \pi(\alpha(i))$ and $\phi'(\pi(i)) = \pi(\phi(i))$
\item for all $i,j \in \{1,2,\ldots,n\}$ and all $k \geq 0$ if
$(\phi')^k(\pi(i)) = \pi(j)$ then $\phi^k(i) = j$.
\end{itemize}
\end{definition}
The second condition ensures that the ramifications are only at the vertices, ie
on the permutation $\sigma$.

If $M$ and $M'$ are endowed with translation structures $\zeta$ and $\zeta'$ we
say that a combinatorial covering $\pi$ between $M$ and $M'$ is a combinatorial
translation covering between $(M,\zeta)$ and $(M',\zeta')$ if furthermore
for all $i \in \{1,2,\ldots,n\}$ we have $\zeta_i = \zeta'_{\pi(i)}$.

\subsection{Generalities}
To a ramified covering $f: S \to S'$ we associate its ramification data.
The degree $\deg(f)$ of $f$ is the number of preimages of each point of $S'$
(counted with multiplicities). For all but finitely many points there is no
multiplicity and there are $\deg(f)$ preimages. The exceptional fibers can
be encoded by their list of multiplicities which are partitions of $\deg(f)$
different from the trivial partition $(1,1,\ldots,1)$. Given the ramification
profile of a fiber $(d_1, d_2, \ldots)$ we associate the \emph{branching number}
\[
\sum_{i} (d_i - 1) \geq 0.
\]
We have the Riemann-Hurwitz equation that relates
the topological data of $f$ to the genera of $S$ and $S'$
\begin{equation}
\label{eq:RiemannHurwitz}
\chi(S) = \deg(f) \cdot \chi(S) - b(f)
\end{equation}
where $\chi(S) = 2 - 2g(S)$ is the Euler characteristic of the surface
and $b(f) = \sum_{x \in S} (\deg_x(f) - 1)$ is the branching number at $x$.

When $S'$ has a translation structure,
the surface $S$ naturally inherits a translation structure by pull-back. One important
combinatorial step in detecting coverings is given the angles of the conical singularities
of $S$ determine what could be the possible multiset of angles for $S'$ and the
associated branching profiles.

Example:
A surface in $\cH(2,2)$ might come from a translation coverings of
\begin{itemize}
\item unramified covering of degree 2 of $\mathcal{H}(2)$,
\item ramified covering of degree $d$ of $\mathcal{H}(0)$ with branching profile
$((3,3,1,1,\ldots,1))$,
\item ramified covering of degree $d$ of $\mathcal{H}(0,0)$ with branching profile
$((3,1,1,\ldots,1), (3,1,1,\ldots,1))$.
\end{itemize}
In the two last cases the degree $d$ can be arbitrary. From Riemann-Hurwitz equation~\eqref{eq:RiemannHurwitz} one can see that this is possible only if $S'$ has genus $0$ or $1$. First of all there is no translation structure on genus 0 surface. And for genus $1$, there are specific algorithms that are explained in Section~\ref{ssec:TorusCoverings}.

\subsection{Torus coverings and restrictions from the holonomy module}
\label{ssec:TorusCoverings}
As we already mentioned, there are no bound of the degree of a cover $S \to S'$
where $S$ has genus $g \geq 1$ and $S'$ has genus $1$. In this section we explain
how to detect whether a translation surface comes from such genus 1 covering.

Let $S$ be a translation surface. We associate its absolute holonomy module
\[
\Hol(S) := \left\{\int_\gamma \omega:\ \gamma \in H_1(S; \bZ)\right\} \subset \bC.
\]
\begin{theorem}
Let $S$ be a translation surface. Then it admits a covering from a torus
if and only if its holonomy module $\Hol(S)$ has rank 2. The covering
is given by the map
\[
\begin{array}{lll}
S & \to & \bC / \Hol(S) \\
x & \mapsto & \int_{x_0}^x \omega
\end{array}
\]
where $x_0$ is an arbitrary point in $S$.
\end{theorem}
\textbf{Question:} how do we compute the degree?

Let $S$ be a translation surface of genus $g$. Since $\rank H_1(S; \bZ) = 2g$
the holonomy module $\Hol(S)$ has rank at most $2g$.
\begin{proposition}
Let $f: S \to S'$ be a translation covering.
Then $\Hol(S)$ is a finite index submodule of $\Hol(S')$.
\end{proposition}
The above proposition is useful to bound the possible degrees of a covering.
For example, a genus 3 surface with an holonomy module of rank $5$ can not
be a translation covering.

\subsection{Detecting translation coverings from surface of genus $\geq 2$}
Finding combinatorial coverings is equivalent to find \emph{block systems} for
permutation groups.  More precisely, if $(\sigma, \alpha, \phi)$ is a
combinatorial covering $\pi$, then the partition induced by the preimages of
$\pi$ is invariant under the group $G$ generated by $\sigma$, $\alpha$ and
$\phi$. It is a block system. The converse is also true: a partition of
$\{1,2,\ldots,n\}$ invariant by $G$ corresponds to a combinatorial covering. In
GAP one can compute it block systems via \texttt{MaximalBlocks} (to obtain the
covering with minimal degree), \texttt{RepresentativesMinimalBlocks} (to obtain
the covering with minimal degree), \texttt{AllBlocks} (to obtain all
coverings).

\textbf{Algorithm:} computing cominatorial coverings of a translation surface $S$
with singularities contained in $\Sigma$
\begin{enumerate}
\item compute the Delaunay cell decomposition of $S$ with respect to $\Sigma$
\item compute the block systems of the Delaunay cell decomposition that
respect the holonomy
\end{enumerate}

\textbf{Issue:} A translation covering $S \to S'$ is not necessarily combinatorial
as we might need to introduce extra marked points before the covering becomes
combinatorial. In other words, we might enlarge $\Sigma$ with extra regular
points. This happens when the coverings over $S'$ is ramified at a
regular point and the branching profile contains some $1$. All such $1$
gives rise to a regular point in $S$

\subsection{Detecting quadratic differentials double cover}
If $S$ comes from the canonical double cover a quadratic differential then it
admits an involution $\iota$ whose derivative is $-1$. The set of conical
singularities $\Sigma$ is preserved by $\iota$ and so is the Delaunay cell
decomposition with respect to $\Sigma$.

\textbf{Algorithm:} Let $(M, \zeta)$ be a Delaunay cell decomposition where $M
= (\sigma, \alpha, \phi)$ is a combinatorial map and $\zeta$ are the holonomy
vectors of a translation structure.  The algorithm consists in testing whether
there exists an ismorphism (of translation surfaces) between $(M, \zeta)$ and
$(M, -\zeta)$.

\textbf{Note:} here there is no issue since the canonical double cover is not
ramified at regular points!

\section{Sah-Arnoux-Fathi invariant, Boshernitzan criterion and skew-products}
Relevant articles: \cite{DoSchmidt}, \cite{DynnikovSkripchenko}, \cite{Boshernitzan}

\begin{enumerate}
\item Boshernitzan criterion allows to certify that a given translation surface (possibly with boundary)
is minimal (or also has no saddle connection inside)
\item The hope is that under induction, either we find a saddle connection or Boshernitzan criterion will apply
\item The above strategy will fail if the Sah-Arnoux-Fathi invariant vanishes. In this situation our only
hope is that $SAF=0$ implies auto-similarity. This is not true in generality (because of skew-product ramified
over points in the field of definition).
\item This raises the question: can we detect primitivity? At the level of
surfaces this is rather elementary: pick the Delaunay triangulation and compute
the automorphism group.
\end{enumerate}

\section{Holomorphic differentials and period matrix}
In this section we consider the holomorphic nature of a translation surface. Recall that a translation
surface corresponds to a pair $(X, \omega)$ where $X$ is a Riemann surface and $\omega$ a non-zero
holomorphic differential. Let us denote $\Omega(X)$ the vector space of holomorphic differentials.
We have the well-known (Riemann? Hodge?).
\begin{theorem}
Let $X$ be a compact Riemann surface of genus $g$. Then the map 
\[
\begin{array}{lll}
\Omega(X) & \to & H^1(X; \bR) \\
\psi & \mapsto & (\gamma \mapsto \int_\gamma \Re(\psi))
\end{array}
\]
is an isomorphism of vector spaces. In particular $\dim_\bC \Omega(X) = g$.
\end{theorem}

We fix a translation surface $(X, \omega)$ given by a triangulation $T$ and a translation
structure $\zeta$. The two problems we want to solve numerically here are
\begin{enumerate}
\item Given an element $\eta \in H^1(X; \bR)$ find the associated holomorphic differential
$\tilde{\eta}$ on $X$ such that $\Re(\tilde{\eta}) = \eta$,
\item Compute the period matrix of $X$.
\end{enumerate}

The method we use is standard in the literature and corresponds to a finite element
method. We use an iterative multigrid approach for the resolution.

References: Royden, Mercat, Bobenko, \ldots

\subsection{Discretizations}
Let $X$ be a Riemann surface. The Hodge star operator $*$ is the operator on 
real one forms given in local holomorphic coordinates $z = x+iy$ by
\[
*(a dx + b dy) = -b dx + a dy.
\]
If $\psi$ is a holomorphic differential then $* \Re(\psi) = \Im(\psi)$.

\begin{definition}
A real differential $\psi$ is called \emph{harmonic} if $d \psi = d*\psi = 0$.
Equivalently, a real differential is harmonic if and only if it is the real
part of a holomorphic differential.
\end{definition}

Let $(T, \zeta)$ be a translation structure and let $\cE$ denote the set of
oriented edges of $T$. 

\begin{definition}
A vector $(\psi(e))_{e \in \cE} \in \cE^\bR$ or $\in \cE^\bC$ such that
$\psi(-e) = -\psi(e)$ is called a \emph{discrete one form}. We denote
by $\Omega_T$ the set of discrete one forms.
\end{definition}

We consider the map
\begin{equation}
\label{eq:discretization}
\psi \mapsto (\int_e \psi)_{e \in \cE}.
\end{equation}

Let $d_T: (\psi(e)) \mapsto (\psi_{e_1} + \psi_{e_2} + \psi_{e_3})$ be the boundary
operator.

\begin{proposition}
Closed forms are mapped to discrete closed forms.
\end{proposition}

Given $(T, \zeta)$ there is a natural section to the discretization map
from~\eqref{eq:discretization}. However, its image is not a smooth
differential but rather a piecewise linear differential with respect to a fixed
holomorphic one form.
\begin{lemma}
Let $t = (e_1, e_2, e_3)$ be a triangle in the complex plane $\bC$.
Let $F_1$, $F_2$, $F_3$ be three real numbers such that $F_1 + F_2 + F_3 = 0$.
Then there exists a unique pair $a,b$ of real numbers such that 
\[
\forall i \in \{1,2,3\},\ F_i = \int_{e_i} (a dx + b dy).
\]
\end{lemma}

The lemma shows that given a translation structure $(T, \zeta)$ with
associated pair $(X, \omega)$ a discrete differential form can
be interpreted as a differential
$\eta = f \Re(\omega) + g \Im(\omega)$ on $X$ where
\begin{enumerate}
\item the functions $f, g: X \to \bR$ are constant on each triangle of $T$,
\item the differential $\eta$ is continuous.
\end{enumerate}


\section{Polygons, billiards and conical structure on the sphere}

\subsection{Polygons}
We are given a list of angles $(\alpha_1, \alpha_2, \ldots, \alpha_m)$ where each
$\alpha_i \in (0,2\pi)$ and such that $\sum_{i=1}^m \alpha_i = (m-2) \pi$. We describe
an algorithm that provides lengths $(\ell_1, \ell_2, \ldots, \ell_m)$ such that
the polygon with the given angle and lengths is valid (ie closes up) and does not have
self-intersection. We simply follow the algorithm from~\cite{EfratFulekKobourovToth} (see the constructive proof of Theorem~1 on pages 7 and 8).

Let $e_1$, $e_2$, \ldots, $e_m$ be vectors parallel to the slope of the sides
(their direction is determiend by the $\alpha_i$ but their lengths can be taken
arbitrarily). Now, the set of valid lengths so that the polygon closes up is a
polytope
\[
P(e_1, e_2, \ldots, e_m) := \left\{(x_1, x_2, \ldots, x_m):
\begin{array}{l}
\forall i \in \{1,2,\ldots,m\},\, x_i \geq 0 \\
x_1 e_1 + x_2 e_2 + \ldots + x_m e_m = 0
\end{array}
\right\}.
\]

\textbf{algorithm:}
The idea is to construct the lengths step by step so that we get rid of the concave angles
(ie the ones $> \pi$). We start by picking any pair of consecutive angles where one is
convex and the other is concave. Then the aim is to fix the length of the segment between
them and replace this pair of angles with $\alpha_i + \alpha_{i+1} - \pi$. This modification can be absorbed by modifying the lengths of the $i-1$ and $i+1$ edges.


\section{Affine groups and periodic points}
We discuss the implementation of~\cite{ChowdhuryEverettFreedmanLee} for computing
periodic points in Veech surfaces. The main focus for now is on Thurston-Veech
constructions for which their theorem applies.

\begin{definition}
A \emph{Thurston-Veech surface} is a translation (or half-translation) surface $M$ such
that both its horizontal and vertical directions decompose into cylinders
whose moduli are commensurable. In such case there exists a pair of affine
elements $\tau_h$ and $\tau_v$ that fix respectively the horizontal and
vertical cylinders acting as a power of a Dehn twist in each of them.

A point $p \in M$ is called \emph{periodic} if its $\langle \tau_h, \tau_v \rangle$
orbit is finite.
\end{definition}

\begin{theorem}[\cite{ChowdhuryEverettFreedmanLee}]
Let $M$ be a Thurston-Veech surface whose field of definition is not $\bQ$
(equivalently it is not square-tiled). Then its set of periodic points
is finite.
\end{theorem}

The proof is constructive and we describe it now.
Starting from a Thurston-Veech surface, we have a canonical partition of the
surface into rectangles $\mathcal{R} = R_1 \cup \ldots \cup R_n$ coming
from the intersection of the horizontal and vertical cylinders. In each
of these rectangles we have canonical horizontal/vertical coordinates and we could
identify points with elements of $\bR^2$. We actually only care about points
in $k^2$ where $k$ is the field of definition which we identify to a finite
dimensional vector space over $\bQ$. In other words we fix once for
all an isomorphism $k \simeq \bQ^d$ where $d = [k:\bQ]$.

If a point is periodic under $\Gamma := \langle \tau_h, \tau_v \rangle$
then it has finite orbits under $\tau_h$ or $\tau_v$. The condition
of being periodic under $\tau_h$ or $\tau_v$ is easily expressed
in terms of the rectangle coordinates. For each rectangle $R$
in $\mathcal{R}$, the points $p=(x,y)$ that have both a
periodic $\tau_h$-orbit and a periodic $\tau_v$-orbit are the
ones that satisfy
\begin{equation}
\label{eq:tauh:tauv:periodicity}
x / h_i \in \bQ
\quad \text{and} \quad
y / h_j \in \bQ
\end{equation}
$h_i$ and $h_j$ are respectively the heights of the horizontal and
vertical cylinder passing through $R$. The conditions~\eqref{eq:tauh:tauv:periodicity}
provide $2d-2$ linearly independent equations over $\bQ^{2d}$. Hence in each region
$R$ in $\mathcal{R}_0$, the candidates to be periodic
points form a $\bQ$-vector subspace of dimension $2$ inside $\bQ^{2d}$.

Now we get additional affine equations for the periodic points using the fact
that if $p$ has a finite $\Gamma$-orbit then for any element $g \in \Gamma$ the
point $g \cdot p$ must have periodic $\tau_h$-orbit and periodic $\tau_v$-orbit.
For each element $g$ we could compute the regions associated to
$\mathcal{R} \vee g^{-1} \cdot \mathcal{R}$ and for
each of them look at points for which $p$ and $g \cdot p$ have periodic
$\tau_h$ and $\tau_v$ orbits. This can be donne by pulling the
equations~\eqref{eq:tauh:tauv:periodicity} via $g$ which is
a $k$-affine map in any region in $\mathcal{R} \vee g^{-1} \cdot \mathcal{R}$
for the canonical coordinates of the domain and target.

\begin{lemma}[\cite{ChowdhuryEverettFreedmanLee}]
\label{lem:finitely:many:g}
If $d\not=1$ then there
exists finitely many elements $g_1$, \ldots, $g_n$ such that
for any region $R$ in $\mathcal{R} \vee g_1^{-1} \cdot \mathcal{R} \vee \cdots \vee g_n^{-1} \mathcal{R}$
the set of points $p \in R$ for which all of $p$, $g_1 \cdot p$,
\ldots, $g_n \cdot p$ have periodic $\tau_h$ and $\tau_v$ orbits
consits of at most one element.
\end{lemma}

Once the above lemma is made effective, the end is easy : give a finite
set it is easy to figure out what are the $\Gamma$-periodic points
in that set in time $O(|\text{set}|)$ (assuming that computing
$\tau_h \cdot p$ from $p$ is a $O(1)$ operation).

Questions
\begin{enumerate}
\item what is the smartest choice of $g_1, \ldots, g_n$ that satisfies
the conclusion of Lemma~\ref{lem:finitely:many:g}? Plausibly
$\{\tau_h, \tau_v, \tau_h^{-1}, \tau_v^{-1}\}$ suffice and if not, we could
add $\tau_h^{\pm 1} \tau_v^{\pm 1}$ that contain pseudo-Anosov.
\item we can get other kind of equations by asking that $p$ is periodic
under $g \tau_h g^{-1}$ (which is parabolic). Are these really
different equations?
\end{enumerate}


\begin{thebibliography}{sage-flatsurf}

\bibitem[sage-flatsurf]{sage-flatsurf}
V. Delecroix, P. Hooper,
\texttt{sage-flatsurf},
\url{https://github.com/videlec/sage-flatsurf}

\bibitem[surface\_dynamics]{surface-dynamics}
V. Delecroix,
\texttt{surface\_dynamics},
\url{https://gitlab.com/videlec/surface_dynamics}

\bibitem[veerer]{veerer}
M. Bell, V. Delecroix, S. Schleimer,
\texttt{veerer},
\url{https://gitlab.com/videlec/veerer}

\bibitem[Bo88]{Boshernitzan}
M. D. Boshernitzan,
\textit{Rank two interval exchange transformations}
Ergodic Theory Dyn. Syst. \textbf{8:3}, 379-394 (1988).

\bibitem[CaSm08]{CaltaSmillie}
K. Calta, J. Smillie
\textit{Algebraically periodic translation surfaces}
J. Mod. Dyn. \textbf{2:2}, 209-248 (2008).

\bibitem[ChEvFrDe]{ChowdhuryEverettFreedmanLee}
Z. Chowdhury, S. Everett, S. Freedman, D. Lee
\textit{Computing Periodic Points on Veech Surfaces}
arXiv:2112.02698 [math.DS]

\bibitem[DoSc16]{DoSchmidt}
H. T. Do, T. A. Schmidt
\textit{New infinite families of pseudo-Anosov maps with vanishing Sah-Arnoux-Fathi invariant}
J. Mod. Dyn. \textbf{10}, 541-561 (2016).

\bibitem[DySk17]{DynnikovSkripchenko}
I. Dynnikov, A. Skripchenko
\textit{Minimality of interval exchange transformations with restrictions}
J. Mod. Dyn. \textbf{11}, 219-248 (2017).
Reviewer: Steve Pederson (Atlanta)
MSC:  37E05 37E35

\bibitem[EFKT]{EfratFulekKobourovToth}
A. Efrat, R. Fulek, S. Kobourov, C. D. T\'oth
\textit{Polygons with prescribed angles in 2D and 3D}
arXiv:10192

\bibitem[EMMW]{EskinMcMullenMukamelWright}
Billiards, quadrilaterals and moduli spaces
A. Eskin, C. McMullen, R. Mukamel, A. Wright
J. Amer. Math. Soc. to appear

\bibitem[Ho13]{Hooper}
W. P. Hooper,
\textit{Another Veech triangle}
Proc. Am. Math. Soc. \textbf{141:3}, 857-865 (2013).

\bibitem[KeSm00]{KenyonSmillie}
R. Kenyon, J. Smillie
\textit{Billiards on rational-angled triangles}
Comment. Math. Helv. 75, No. 1, 65-108 (2000).

\bibitem[LaZv03]{LandoZvonkin}
S. Lando and A. Zvonkin
\textit{Graphs on surfaces and their applications}
Springer, (2004).

\bibitem[LaNg16]{LanneauNguyen-CompletePeriodicity}
E. Lanneau, D.-M. Nguyen
\textit{Complete periodicity of Prym eigenforms}
Ann. Sci. Éc. Norm. Supér. (4) \textbf{49:1}, 87-130 (2016).

\bibitem[LoPoVi07]{LowensteinPoggiaspallaVivaldi2007}
G. Poggiaspalla, J. H. Lowenstein, F. Vivaldi,
\textit{Interval exchange transformations over algebraic number fields: the cubic Arnoux-Yoccoz model}
Dyn. Syst. \textbf{22:1}, 73-106 (2007).

\bibitem[LoPoVi08]{LowensteinPoggiaspallaVivaldi2008}
G. Poggiaspalla, J. H. Lowenstein, F. Vivaldi,
\textit{Geometric representation of interval exchange maps over algebraic number fields},
Nonlinearity \textbf{21:1}, 149-177 (2008).

\bibitem[McMMuWr17]{McMullenMukamelWright2017}
C. T. McMullen, R. Mukamel, A. Wright,
\textit{Cubic curves and totally geodesic subvarieties of moduli space}
Ann. Math. (2) \textbf{185:3}, 957-990 (2017).

\bibitem[MiWr18]{MirzakhaniWright2018}
M. Mirzakhani, A. Wright,
\textit{Full-rank affine invariant submanifolds}
Duke Math. J. \textbf{167:1}, 1-40 (2018).

\bibitem[Wa98]{Ward1998}
C. C. Ward,
\textit{Calculation of Fuchsian groups associated to billiards in a rational triangle}
Ergodic Theory Dyn. Syst. \textbf{18:4}, 1019-1042 (1998).

\bibitem[Wr14]{Wright-field-of-def}
A.~Wright
\textit{The field of definition of affine invariant submanifolds of the moduli space of abelian differentials}
Geom. Topol. 18, No. 3, 1323-1341 (2014).

\bibitem[Wr15]{Wright-cylinder-deformations}
A.~Wright,
\textit{Cylinder deformations in orbit closures of translation surfaces}
Geom. Topol. 19, No. 1, 413-438 (2015).

\bibitem[Yo10]{Yoccoz}
Jean-Christophe Yoccoz
\textit{Interval exchange maps and translation surfaces}
in Homogeneous flows, moduli spaces and arithmetic.
Proceedings of the Clay Mathematics Institute summer school,
(2010).
\end{thebibliography}

\end{document}
